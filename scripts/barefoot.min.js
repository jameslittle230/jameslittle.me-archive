"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _extends=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var o=arguments[e];for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(t[n]=o[n])}return t},_createClass=function(){function t(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,o,n){return o&&t(e.prototype,o),n&&t(e,n),e}}(),BareFoot=function(){function t(){var e=this,o=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];_classCallCheck(this,t);var n={scope:"body",divFootnotesQuery:".footnotes",footnotesQuery:"[id^='fn']",supQuery:'a[href^="#fnref"]',fnButtonMarkup:'<button class="footnote-button" id="{{FOOTNOTEREFID}}" data-footnote="{{FOOTNOTEID}}" alt="See Footnote {{FOOTNOTENUMBER}}" rel="footnote" data-fn-number="{{FOOTNOTENUMBER}}" data-fn-content="{{FOOTNOTECONTENT}}"></button>',fnContentMarkup:'<div class="bf-footnote" id="{{FOOTNOTEID}}"><div class="footnote-wrapper"><div class="footnote-content" tabindex="0">{{FOOTNOTECONTENT}}</div></div><div class="footnote-tooltip" aria-hidden="true"></div>',activeCallback:null,activeBtnClass:"is-active",activeFnClass:"footnote-is-active",backdropClass:"footnote-backdrop",buttonClass:"footnote-button",fnContainer:"footnote-container",fnClass:"bf-footnote",fnContentClass:"footnote-content",fnWrapperClass:"footnote-wrapper",tooltipClass:"footnote-tooltip"};return this.config=_extends({},n,o),this.divFootnotes=[].slice.call(document.querySelectorAll(this.config.divFootnotesQuery)),this.divFootnotes?(this.footnotes=this.divFootnotes.map(function(t){return t.querySelectorAll(e.config.footnotesQuery)}),Element.prototype.matches=Element.prototype.matches||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector||function(t){return-1!==[].indexOf.call(document.querySelectorAll(t),this)},void(Element.prototype.closest=Element.prototype.closest||function(t){for(var e=this;null!==e;){var o=e.parentElement;if(null!==o&&o.matches(t))return o;e=o}return null})):!1}return _createClass(t,[{key:"removeBackLinks",value:function(t,e){var o=void 0;return e.indexOf(" ")>=0&&(e=e.trim().replace(/\s+/g,"|").replace(/(.*)/g,"($1)")),0===e.indexOf("#")&&(e=e.slice(1)),o=new RegExp("(\\s|&nbsp;)*<\\s*a[^#<]*#"+e+"[^>]*>(.*?)<\\s*/\\s*a>","g"),t.replace(o,"").replace("[]","")}},{key:"buildButton",value:function(t,e,o,n){return this.config.fnButtonMarkup.replace(/\{\{FOOTNOTEREFID\}\}/g,t).replace(/\{\{FOOTNOTEID\}\}/g,e).replace(/\{\{FOOTNOTENUMBER\}\}/g,o).replace(/\{\{FOOTNOTECONTENT\}\}/g,n)}},{key:"buildContent",value:function(t,e){return this.config.fnContentMarkup.replace(/\{\{FOOTNOTEID\}\}/g,t).replace(/\{\{FOOTNOTECONTENT\}\}/g,e)}},{key:"clickAction",value:function(t){var e=void 0,o=void 0,n=void 0,i=void 0,s=void 0;e=t.target,o=e.getAttribute("data-fn-content"),n=e.getAttribute("data-footnote"),e.nextElementSibling?this.dismissFootnotes():(this.dismissFootnotes(),i=this.buildContent(n,o),e.insertAdjacentHTML("afterend",i),s=e.nextElementSibling,this.calculateOffset(s,e),this.calculateSpacing(s),e.classList.add(this.config.activeBtnClass),s.classList.add(this.config.activeFnClass),s.querySelector("."+this.config.fnContentClass).focus(),"ontouchstart"in document.documentElement&&document.body.classList.add(this.config.backdropClass),this.config.activeCallback&&this.config.activeCallback(e,s))}},{key:"calculateOffset",value:function(t,e){var o=void 0,n=void 0,i=void 0,s=void 0,a=void 0,c=void 0,l=void 0,r=void 0,d=void 0,u=void 0,f=void 0,v=void 0;e=e||t.previousElementSibling,i=e.offsetLeft,s=e.offsetWidth,o=t.querySelector("."+this.config.tooltipClass),u=o.clientWidth,n=t.parentNode,a=n.clientWidth,c=n.offsetLeft,l=t.offsetWidth,r=-(l/2-a/2),v=window.innerWidth||window.availWidth,0>c+r?r-=c+r:c+r+l>v&&(r-=c+r+l+a/2-v),t.style.left=r+"px",d=c+r,f=c-d+a/2-u/2,o.style.left=f+"px"}},{key:"removeFootnoteChild",value:function(t){return t.parentNode.removeChild(t)}},{key:"debounce",value:function(t,e,o){var n;return function(){for(var i=this,s=arguments.length,a=Array(s),c=0;s>c;c++)a[c]=arguments[c];var l=function(){n=null,o||t.apply(i,a)};clearTimeout(n),n=setTimeout(l,e),o&&!n&&t.apply(this,a)}}},{key:"resizeAction",value:function(){var t=this,e=document.querySelectorAll("."+this.config.activeFnClass);e.length&&[].forEach.call(e,function(){t.calculateOffset(fn),t.calculateSpacing(fn)})}},{key:"calculateSpacing",value:function(t){var e=void 0,o=void 0,n=void 0,i=void 0,s=void 0;i=this.calculateMargins(t),s=window.innerHeight||window.availHeight,e=t.getBoundingClientRect(),o=e.height,n=e.bottom,n>s-i.bottom?t.classList.add(this.config.fnOnTopClass):s-(o+i.top)>n&&t.classList.contains(this.config.fnOnTopClass)&&t.classList.remove(this.config.fnOnTopClass)}},{key:"scrollAction",value:function(){var t=this,e=document.querySelectorAll("."+this.config.activeFnClass);if(e.length){window.innerHeight||window.availHeight,this.calculateMargins(e[0]);[].forEach.call(e,function(e){t.calculateSpacing(e)})}}},{key:"calculateMargins",value:function(t){var e=window.getComputedStyle(t,null);return{top:parseFloat(e.marginTop),right:parseFloat(e.marginRight),bottom:parseFloat(e.marginBottom),left:parseFloat(e.marginLeft)}}},{key:"documentAction",value:function(t){t.target.closest("."+this.config.fnContainer)||this.dismissFootnotes()}},{key:"dismissFootnotes",value:function(){var t=this,e=document.querySelectorAll("."+this.config.activeFnClass);e.length&&[].forEach.call(e,function(e){e.previousElementSibling.classList.remove(t.config.activeBtnClass),e.addEventListener("transitionend",t.removeFootnoteChild(e),!1),e.classList.remove(t.config.activeFnClass)}),document.body.classList.contains(this.config.backdropClass)&&document.body.classList.remove(this.config.backdropClass)}},{key:"init",value:function(){var t=this;[].forEach.call(this.footnotes,function(e,o){var n=e[0].closest(t.config.scope);[].forEach.call(e,function(e,o){var i=void 0,s=void 0,a=void 0,c=void 0,l=void 0;c=o+1,s=e.querySelector(t.config.supQuery).getAttribute("href"),i=t.removeBackLinks(e.innerHTML.trim(),s),i=i.replace(/"/g,"&quot;").replace(/&lt;/g,"&ltsym;").replace(/&gt;/g,"&gtsym;"),0!==i.indexOf("<")&&(i="<p>"+i+"</p>"),a=n.querySelector(s.replace(":","\\:")),l='<div class="'+t.config.fnContainer+'">'+t.buildButton(s,e.id,c,i)+"</div>",a.insertAdjacentHTML("afterend",l),a.parentNode.removeChild(a)})}),this.eventsSetup()}},{key:"dismissOnEsc",value:function(t){return 27===t.keyCode&&document.activeElement.matches("."+this.config.fnContentClass)?(document.activeElement.closest("."+this.config.activeFnClass).previousElementSibling.focus(),this.dismissFootnotes()):void 0}},{key:"eventsSetup",value:function(){var t=this;[].forEach.call(document.querySelectorAll("."+this.config.buttonClass),function(e){e.addEventListener("click",t.clickAction.bind(t))}),window.addEventListener("resize",this.debounce(this.resizeAction.bind(this),100)),window.addEventListener("scroll",this.debounce(this.scrollAction.bind(this),100)),window.addEventListener("keyup",this.dismissOnEsc.bind(this)),document.body.addEventListener("click",this.documentAction.bind(this)),document.body.addEventListener("touchend",this.documentAction.bind(this)),this.divFootnotes.forEach(function(t){return t.parentNode.removeChild(t)})}}]),t}();